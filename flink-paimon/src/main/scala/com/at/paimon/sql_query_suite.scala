package com.at.paimon

object sql_query_suite extends CommonSuite {
  def main(args: Array[String]): Unit = {

    val (env, tableEnv) = initStreamEnv()

    tableEnv.executeSql("show catalogs").print()
    tableEnv.executeSql("show current catalog").print()

    tableEnv.executeSql("use catalog fs_paimon_catalog")

    //    tableEnv.executeSql("select * from fs_table_1").print()

    //    tableEnv.executeSql(
    //      """
    //        |SELECT * FROM fs_table_1 /*+ OPTIONS('scan.snapshot-id' = '7') */
    //        |""".stripMargin
    //    ).print()
    // OPTIONS('scan.snapshot-id' = '5')
    //+----+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+
    //| op |              user_id |              item_id |                       behavior |                   ts |                             dt |                             hh |
    //+----+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+
    //| +I |                    1 |                  100 |                             pv |        1751620261056 |                     2025-07-04 |                             17 |
    //| +I |                    3 |                  110 |                         search |        1751618213242 |                     2025-07-04 |                             16 |
    //| +I |                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |
    //| -D |                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |
    //| +I |                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |
    //| -D |                    1 |                  100 |                             pv |        1751620261056 |                     2025-07-04 |                             17 |
    //| -D |                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |

    // OPTIONS('scan.snapshot-id' = '7')
    //+----+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+
    //| op |              user_id |              item_id |                       behavior |                   ts |                             dt |                             hh |
    //+----+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+
    //| +I |                    1 |                  100 |                             pv |        1751620261056 |                     2025-07-04 |                             17 |
    //| +I |                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |
    //| -D |                    1 |                  100 |                             pv |        1751620261056 |                     2025-07-04 |                             17 |
    //| -D |                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |

    // 增量快照只支持 batch 模式
    //     val settings = EnvironmentSettings.newInstance.inBatchMode().build
    tableEnv.executeSql(
      """
        |SELECT * FROM fs_table_1 /*+ OPTIONS('incremental-between' = '5,7') */
        |""".stripMargin
    ).print()
    // OPTIONS('incremental-between' = '5,7')
    //+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+
    //|              user_id |              item_id |                       behavior |                   ts |                             dt |                             hh |
    //+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+
    //|                    1 |                  100 |                             pv |        1751618205242 |                     2025-07-04 |                             16 |
    //|                    1 |                  100 |                             pv |        1751620261056 |                     2025-07-04 |                             17 |
    //+----------------------+----------------------+--------------------------------+----------------------+--------------------------------+--------------------------------+


  }
}
